<div class="p-6" data-paper-id="{{ paper.id }}">
    <!-- Header -->
    <div class="mb-6">
        <div class="flex items-start justify-between gap-4 mb-4">
            <h1 class="text-xl font-bold text-content-primary leading-relaxed">
                {{ paper.title }}
            </h1>
            
            <!-- Pick Button: context=detail so server returns button HTML, not checkbox -->
            {% if paper.status == 'read' %}
            <!-- Disabled Pick button for read papers -->
            <button disabled
                    class="flex-shrink-0 px-4 py-2 rounded-lg font-semibold text-sm
                           bg-accent-muted-subtle text-content-muted opacity-50 cursor-not-allowed"
                    title="ì½ì€ ë…¼ë¬¸ì€ Pickí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤">
                <span class="flex items-center gap-1.5">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                    </svg>
                    Pick
                </span>
            </button>
            {% else %}
            <button hx-post="/actions/pick/{{ paper.id }}"
                    hx-headers='{"X-Pick-Context": "detail"}'
                    hx-swap="outerHTML"
                    class="flex-shrink-0 px-4 py-2 rounded-lg font-semibold text-sm transition-all
                           {% if paper.is_picked %}
                           bg-accent-warning-subtle text-accent-warning hover:opacity-80
                           {% else %}
                           bg-accent-muted-subtle text-content-secondary hover:bg-accent-primary-subtle hover:text-accent-primary
                           {% endif %}">
                {% if paper.is_picked %}
                <span class="flex items-center gap-1.5">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                    </svg>
                    Picked
                </span>
                {% else %}
                <span class="flex items-center gap-1.5">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                    </svg>
                    Pick
                </span>
                {% endif %}
            </button>
            {% endif %}
        </div>
        
        <!-- Meta Info -->
        <div class="flex flex-wrap items-center gap-3 text-sm">
            {% if paper.journal %}
            <span class="bg-accent-primary-subtle text-accent-primary px-3 py-1 rounded-full font-medium">
                {{ paper.journal }}
            </span>
            {% endif %}
            
            {% if paper.published %}
            <span class="text-content-muted flex items-center gap-1">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
                {{ paper.published }}
            </span>
            {% endif %}
            
            <span class="{% if paper.status == 'new' %}badge-primary
                         {% elif paper.status == 'read' %}badge-success
                         {% else %}badge-muted{% endif %}">
                {{ paper.status }}
            </span>
            
            {% if ai_score is defined and ai_score is not none %}
                {% set _detail_is_top = (ai_is_top is defined and ai_is_top) %}
                {% set _detail_is_gold = (ai_is_gold is defined and ai_is_gold) %}
                {% set _detail_is_blue = (ai_is_blue is defined and ai_is_blue) %}
                {% if _detail_is_top or _detail_is_gold or _detail_is_blue %}
                <span class="{% if _detail_is_top %}badge-ai-gold-lg{% elif _detail_is_gold %}badge-ai-gold-lg{% else %}badge-ai-blue-lg{% endif %}">
                    <svg class="w-3.5 h-3.5" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M8 0L6.4 6.4 0 8l6.4 1.6L8 16l1.6-6.4L16 8 9.6 6.4z"/>
                    </svg>
                    {{ ai_score|round(0)|int }}% match
                </span>
                {% endif %}
            {% endif %}
        </div>
    </div>
    
    <!-- Authors: ê°€ë¡œ ë‚˜ì—´, 3ëª… + ì™¸ nëª…, í´ë¦­ ì‹œ ì „ì²´ -->
    {% if authors_list %}
    <div class="mb-6">
      <h2 class="section-header mb-2">ì €ì</h2>
    
      <p class="text-content-secondary text-sm leading-relaxed">
        {% set total = authors_list | length %}
    
        {% if total > 3 %}
          {% set first = authors_list[:3] %}
          {% set rest = authors_list[3:] %}
    
          <details class="inline group">
            <summary class="inline cursor-pointer list-none [&::-webkit-details-marker]:hidden text-content-secondary text-sm leading-relaxed">
              <span>
                {{ first | join(", ") }}
                <span class="group-open:hidden"> ì™¸ {{ total - 3 }}ëª…</span>
                <span class="hidden group-open:inline">, {{ rest | join(", ") }}</span>
              </span>
    
              <span class="ml-1 text-gray-400/70 text-xs group-open:hidden">ë”ë³´ê¸°</span>
              <span class="ml-1 text-gray-400/70 text-xs hidden group-open:inline">ì ‘ê¸°</span>
            </summary>
          </details>
        {% else %}
          <span class="text-content-secondary text-sm leading-relaxed">
            {{ authors_list | join(", ") }}
          </span>
        {% endif %}
      </p>
    </div>
    {% endif %}
    
    
    <!-- Abstract: DOI ìˆìœ¼ë©´ OpenAlex ë¡œë“œ, ì—†ìœ¼ë©´ DB ì´ˆë¡ -->
    {% if paper.doi %}
    <div id="detail-enrich"
         hx-get="/papers/{{ paper.id }}/enrich"
         hx-trigger="load"
         hx-swap="innerHTML"
         class="mb-6">
        <div class="flex items-center gap-2 text-sm text-content-muted">
            <svg class="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <span>ì´ˆë¡ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span>
        </div>
    </div>
    {% elif paper.abstract %}
    <div class="mb-6">
        <h2 class="section-header mb-2">ì´ˆë¡</h2>
        <div class="abstract-box">
            <p class="text-content-secondary text-sm leading-[1.85] whitespace-pre-wrap">{{ paper.abstract | unescape_html | clean_abstract }}</p>
        </div>
    </div>
    {% endif %}
    
    <!-- í†µí•© ë§í¬: ì´ˆë¡ ì•„ë˜, View Full Paper ë²„íŠ¼ + DOI ë³µì‚¬ ê°€ëŠ¥ í…ìŠ¤íŠ¸ -->
    {% if paper.link or paper.doi %}
    <div class="mb-6 flex flex-wrap items-center gap-3">
        {% if paper.link %}
        <a href="{{ paper.link }}" target="_blank" rel="noopener noreferrer"
           class="inline-flex items-center gap-1.5 px-4 py-2 rounded-lg text-sm font-medium transition-colors
                  bg-accent-primary-subtle text-accent-primary hover:bg-accent-primary hover:text-content-inverse">
            <span>ğŸ“„</span> View Full Paper
        </a>
        {% endif %}
        {% if paper.doi %}
        <span class="inline-flex items-center gap-1.5 px-4 py-2 rounded-lg text-sm font-medium
                     bg-accent-muted-subtle text-content-secondary border border-border-base"
              title="ë³µì‚¬í•˜ë ¤ë©´ í…ìŠ¤íŠ¸ë¥¼ ì„ íƒí•˜ì„¸ìš”">
            <span>ğŸ”—</span> DOI: <span class="select-all font-mono">{{ paper.doi }}</span>
        </span>
        {% endif %}
    </div>
    {% endif %}
    
    <!-- AI Semantic Insight (lazy-loaded) -->
    <div id="detail-ai-insight"
         hx-get="/papers/{{ paper.id }}/ai-insight"
         hx-trigger="load"
         hx-swap="innerHTML"
         class="mb-6">
        <div class="flex items-center gap-2 text-sm text-content-muted">
            <svg class="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <span>AI ë¶„ì„ ì¤‘...</span>
        </div>
    </div>

    <!-- Source Info -->
    <div class="pt-4 border-t border-border-base text-xs text-content-muted">
        <div class="flex items-center gap-4">
            <span>ì†ŒìŠ¤: {{ paper.source }}</span>
            {% if paper.created_at %}
            <span>ìˆ˜ì§‘ì¼: {{ paper.created_at[:10] }}</span>
            {% endif %}
            <span>ID: {{ paper.id }}</span>
        </div>
    </div>
</div>
